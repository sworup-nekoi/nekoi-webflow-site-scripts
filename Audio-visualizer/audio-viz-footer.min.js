(function(){function t(){try{const l=document.getElementById("audio-viz")||document.querySelector(".audio-visualizer");if(!l)return;const u=document.getElementById("site-music")||document.querySelector('audio[data-role="site-music"]')||document.querySelector("audio#site-audio")||document.querySelector("audio[src]");if(!u)return;try{u.crossOrigin=u.crossOrigin||"anonymous"}catch{}u.preload=u.preload||"auto";try{u.setAttribute("playsinline",""),u.setAttribute("webkit-playsinline","")}catch{}const m="viz:was-playing",h="viz:last-time",p=document.createElement("canvas"),v=p.getContext("2d");Object.assign(p.style,{position:"absolute",inset:"0",width:"100%",height:"100%",display:"block",pointerEvents:"none"}),l.appendChild(p);const y=document.body||document.documentElement,g=(t,e)=>{let a=getComputedStyle(y).getPropertyValue(t).trim();return a||(a=getComputedStyle(document.documentElement).getPropertyValue(t).trim()),a||e},f=(t,e)=>{const a=document.createElement("div");a.style.position="absolute",a.style.visibility="hidden",a.style.width=`var(${t})`,(document.body||document.documentElement).appendChild(a);const n=parseFloat(getComputedStyle(a).width);return a.remove(),Number.isFinite(n)?n:e};let w,M,x,b,z,S,E,I,F,T,L,A,_,V,C,k,q,P,O,B,R,D,N;function t(){w=g("--viz-bar","#fff"),M=g("--viz-bar-alt",w),x=g("--viz-cap","transparent"),E=f("--viz-pad-x",8),I=f("--viz-gap",2),F=Math.max(1,parseInt(g("--viz-max-bars","64"),10)||64),T=Math.max(1,f("--viz-min-bar",8)),b=f("--viz-cap-gap",2),z=f("--viz-cap-h",2),S=Math.max(.02,parseFloat(g("--viz-cap-drop","0.6"))||.6),L=Math.max(.4,parseFloat(g("--viz-band-curve","1.6"))||1.6),A=Math.max(1,parseInt(g("--viz-alt-every","2"),10)||2),_="0"!==g("--viz-agc","1"),V=Math.min(.5,Math.max(.01,parseFloat(g("--viz-agc-smooth","0.1"))||.1)),C=Math.max(1,parseFloat(g("--viz-agc-max","16"))||16),k=Math.max(.1,parseFloat(g("--viz-sensitivity","1.35"))||1.35),q=Math.min(.98,Math.max(0,parseFloat(g("--viz-smoothing","0.60"))||.6)),P=Math.max(0,parseFloat(g("--viz-quiet-boost","1.45"))||1.45),O=Math.min(1,Math.max(0,parseFloat(g("--viz-min-active-frac","0.40"))||.4)),B=f("--viz-min-active-px",3),R=f("--viz-idle-px",2),D=Math.max(0,Math.min(.2,parseFloat(g("--viz-silence-thresh","0.02"))||.02)),N=(g("--viz-align","left")||"left").toLowerCase()}t();const W=new MutationObserver(t);W.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme","data-wf-theme","class"]}),W.observe(document.body,{attributes:!0,attributeFilter:["data-theme","data-wf-theme","class"]});const j=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)");j&&j.addEventListener&&j.addEventListener("change",t);const G=window.AudioContext||window.webkitAudioContext,H=new G;let U;try{U=H.createMediaElementSource(u)}catch{return}const $=H.createAnalyser();$.fftSize=512,$.smoothingTimeConstant=q;const J=H.createGain();function e(t,e=300){const a=H.currentTime,n=Math.max(.001,(0|e)/1e3),i=J.gain;try{i.cancelScheduledValues(a),i.setValueAtTime(i.value,a),i.linearRampToValueAtTime(Math.max(0,Math.min(1,t)),a+n)}catch{}return new Promise(t=>setTimeout(t,Math.max(0,0|e)))}async function a(t=800){try{await H.resume()}catch{}try{await u.play()}catch{}sessionStorage.setItem(m,"1"),await e(1,t)}async function n(t=400){await e(0,t),u.pause(),sessionStorage.setItem(m,"0");try{sessionStorage.setItem(h,String(u.currentTime||0))}catch{}}function i(t={}){const e=t.selector||"[data-viz-toggle]";document.querySelectorAll(e).forEach(e=>o(e,t))}function o(t,e={}){const i=+t.dataset.fadeIn||e.fadeInMs||800,o=+t.dataset.fadeOut||e.fadeOutMs||400;t.setAttribute("role","button"),t.hasAttribute("tabindex")||(t.tabIndex=0);const s=()=>{try{H.resume().catch(()=>{});const t=H.currentTime;try{J.gain.cancelScheduledValues(t),J.gain.setValueAtTime(0,t)}catch{}u.play().then(()=>{setTimeout(()=>{try{u.pause()}catch{}},0)}).catch(()=>{})}catch{}};t.addEventListener("touchstart",s,{passive:!0,once:!0}),t.addEventListener("pointerdown",s,{passive:!0,once:!0});let r=0;const c=t=>{t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation())},d=e=>{t.classList.toggle("is-playing",!!e),t.setAttribute("aria-pressed",e?"true":"false")},l=t=>{t&&"click"===t.type&&Date.now()-r<350||(c(t),u.paused||u.ended?a(i).then(()=>d(!0)):n(o).then(()=>d(!1)))};t.addEventListener("touchend",t=>{r=Date.now(),l(t)},{passive:!1}),t.addEventListener("click",l,{passive:!1}),t.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||l(t)});const h="1"===sessionStorage.getItem(m)&&!u.paused;d(h)}J.gain.value=0,U.connect(J),J.connect(H.destination),J.connect($),function(){if(u.__vizPersistBound)return;u.__vizPersistBound=!0;const t=()=>{try{sessionStorage.setItem(h,String(u.currentTime||0))}catch{}};u.addEventListener("pause",t),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&t()}),window.addEventListener("pagehide",t),setInterval(()=>{u.paused||t()},2e3)}(),window.__audioViz={audio:u,context:H,analyser:$,gain:J,fadeTo:e,playWithFade:a,pauseWithFade:n,initToggle:i};let K=Math.max(1,window.devicePixelRatio||1);const Q={count:0,ranges:[]};function s(){K=Math.max(1,window.devicePixelRatio||1);const e=l.clientWidth||1,a=l.clientHeight||1;p.width=Math.max(1,Math.round(e*K)),p.height=Math.max(1,Math.round(a*K)),v.setTransform(K,0,0,K,0,0),t(),Q.count=0}s(),window.addEventListener("resize",s,{passive:!0}),window.visualViewport&&visualViewport.addEventListener("resize",s,{passive:!0});const X=new Uint8Array($.frequencyBinCount);function r(t,e,a=2,n=e){const i=Math.max(a+1,Math.min(n,e)),o=Math.max(1,i-a),s=[];for(let e=0;e<t;e++){const n=e/t,r=(e+1)/t,c=Math.pow(n,L),d=Math.pow(r,L);let l=Math.floor(a+c*o),u=Math.floor(a+d*o);l<a&&(l=a),u<=l&&(u=Math.min(i,l+1)),u>i&&(u=i),s.push({i0:l,i1:u})}return s}let Y=[],Z=1,tt=0;function c(){tt++%12==0&&t(),$.smoothingTimeConstant=q;const e=p.width/K,a=p.height/K;v.clearRect(0,0,e,a),$.getByteFrequencyData(X);const n=Math.max(1,e-2*E);let i=Math.max(1,Math.floor(n/Math.max(1,T)));i=Math.min(F,i);let o=[];for(let t=0;t<i;t++)o[t]=t;"right"===N&&o.reverse();const s=I*Math.max(0,i-1),d=Math.max(1,(n-s)/i),l=a-2,m=Math.max(1,l-6);Q.count!==i&&(Q.count=i,Q.ranges=r(i,X.length,2,X.length),Y=new Array(i).fill(l-b));const h=new Array(i);let y=1e-4;for(let t=0;t<i;t++){const{i0:e,i1:a}=Q.ranges[t];let n=0,i=Math.max(1,a-e);for(let t=e;t<a;t++)n+=X[t]||0;let o=n/i/255;o=Math.max(0,Math.min(1,o*k)),h[t]=o,o>y&&(y=o)}const g=u.paused||u.muted||y<D;if(!g&&_){const t=Math.min(C,.9/y);Z+=(t-Z)*V}else Z+=.2*(1-Z);const f=!g&&y<.08?1+P*(.08-y)/.08:1,L=Math.max(1,Math.floor(i*O)),W=Array.from({length:i},(t,e)=>e).sort((t,e)=>h[e]-h[t]),j=new Set(W.slice(0,L));for(let t=0;t<i;t++){const e=o[t],a=E+t*(d+I);let n,i;if(g)n=Math.min(m,R),i=l-n;else{const t=h[e];n=Math.max(2,Math.min(m,t*Z*f*m)),j.has(e)&&n<B&&(n=Math.min(m,B)),i=l-n}const s=t%A==A-1;if(v.fillStyle=s?M:w,v.fillRect(a,i,d,n),"transparent"!==x&&""!==x){const t=i-b;let n=Number.isFinite(Y[e])?Y[e]:t;n=t<n?t:Math.min(n+S,t),Y[e]=n,v.fillStyle=x,v.fillRect(a,n-z,d,z)}}requestAnimationFrame(c)}u.addEventListener("play",()=>sessionStorage.setItem(m,"1")),u.addEventListener("pause",()=>sessionStorage.setItem(m,"0")),window.addEventListener("pagehide",()=>{try{sessionStorage.setItem(h,String(u.currentTime||0))}catch{}}),u.addEventListener("loadedmetadata",()=>{try{const t=parseFloat(sessionStorage.getItem(h)||"0");Number.isFinite(t)&&u.duration&&t<u.duration&&(u.currentTime=t)}catch{}},{once:!0});const et=document.querySelector(".preloader"),at=document.querySelector(".overlay-expander"),nt=!(!et||"none"===getComputedStyle(et).display);if(nt){const t=()=>{if(!et)return!0;if(!et.parentNode)return!0;const t=getComputedStyle(et);return"none"===t.display},a=()=>!(!at||"none"===getComputedStyle(at).pointerEvents);function d(){const a=[];et&&a.push(et),at&&at!==et&&a.push(at);let n=!1;const i={once:!0,capture:!0},o=s=>{if(n)return;n=!0;const r=H.currentTime;try{J.gain.cancelScheduledValues(r),J.gain.setValueAtTime(0,r)}catch{}H.resume().catch(()=>{}),u.play().then(()=>{sessionStorage.setItem(m,"1")}).catch(()=>{});const c=800;let d,l;const h=()=>{a.forEach(t=>t.removeEventListener("click",o,i)),d&&d.disconnect(),l&&clearInterval(l)},p=()=>{o._didFade||t()&&(o._didFade=!0,e(1,c),h())};et&&(d=new MutationObserver(p),d.observe(et,{attributes:!0,attributeFilter:["style","class"]})),l=setInterval(p,120)};a.forEach(t=>t.addEventListener("click",o,i))}if(a())d();else{let t,e,n;const i=()=>{a()&&(o(),d())},o=()=>{t&&t.disconnect(),e&&clearInterval(e),n&&clearTimeout(n)};at&&(t=new MutationObserver(i),t.observe(at,{attributes:!0,attributeFilter:["style","class"]})),e=setInterval(i,120),n=setTimeout(i,15e3)}}else"1"===sessionStorage.getItem(m)&&u.play().then(()=>{H.resume().catch(()=>{}),e(1,800)}).catch(()=>{});window.__audioViz&&"function"==typeof window.__audioViz.initToggle&&window.__audioViz.initToggle(),c()}catch(t){console.error("[viz] init error:",t)}}window.__audioVizInit||(window.__audioVizInit=!0,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t,{once:!0}):t())})();