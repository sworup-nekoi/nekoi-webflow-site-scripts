(function(){function t(){try{const m=document.getElementById("audio-viz")||document.querySelector(".audio-visualizer");if(!m)return;const h=document.getElementById("site-music")||document.querySelector('audio[data-role="site-music"]')||document.querySelector("audio#site-audio")||document.querySelector("audio[src]");if(!h)return;try{h.crossOrigin=h.crossOrigin||"anonymous"}catch{}h.preload=h.preload||"auto";try{h.setAttribute("playsinline",""),h.setAttribute("webkit-playsinline","")}catch{}const p="viz:was-playing",v="viz:last-time",g=document.createElement("canvas"),w=g.getContext("2d");Object.assign(g.style,{position:"absolute",inset:"0",width:"100%",height:"100%",display:"block",pointerEvents:"none"}),m.appendChild(g);const y=document.body||document.documentElement,f=(t,e)=>{let a=getComputedStyle(y).getPropertyValue(t).trim();return a||(a=getComputedStyle(document.documentElement).getPropertyValue(t).trim()),a||e},M=(t,e)=>{const a=document.createElement("div");a.style.position="absolute",a.style.visibility="hidden",a.style.width=`var(${t})`,(document.body||document.documentElement).appendChild(a);const n=parseFloat(getComputedStyle(a).width);return a.remove(),Number.isFinite(n)?n:e};let x,z,b,S,E,I,L,F,T,A,V,_,k,C,q,P,O,R,B,D,N,W,j;function t(){x=f("--viz-bar","#fff"),z=f("--viz-bar-alt",x),b=f("--viz-cap","transparent"),L=M("--viz-pad-x",8),F=M("--viz-gap",2),T=Math.max(1,parseInt(f("--viz-max-bars","64"),10)||64),A=Math.max(1,M("--viz-min-bar",8)),S=M("--viz-cap-gap",2),E=M("--viz-cap-h",2),I=Math.max(.02,parseFloat(f("--viz-cap-drop","0.6"))||.6),V=Math.max(.4,parseFloat(f("--viz-band-curve","1.6"))||1.6),_=Math.max(1,parseInt(f("--viz-alt-every","2"),10)||2),k="0"!==f("--viz-agc","1"),C=Math.min(.5,Math.max(.01,parseFloat(f("--viz-agc-smooth","0.1"))||.1)),q=Math.max(1,parseFloat(f("--viz-agc-max","16"))||16),P=Math.max(.1,parseFloat(f("--viz-sensitivity","1.35"))||1.35),O=Math.min(.98,Math.max(0,parseFloat(f("--viz-smoothing","0.60"))||.6)),R=Math.max(0,parseFloat(f("--viz-quiet-boost","1.45"))||1.45),B=Math.min(1,Math.max(0,parseFloat(f("--viz-min-active-frac","0.40"))||.4)),D=M("--viz-min-active-px",3),N=M("--viz-idle-px",2),W=Math.max(0,Math.min(.2,parseFloat(f("--viz-silence-thresh","0.02"))||.02)),j=(f("--viz-align","left")||"left").toLowerCase()}t();const G=new MutationObserver(t);G.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme","data-wf-theme","class"]}),G.observe(document.body,{attributes:!0,attributeFilter:["data-theme","data-wf-theme","class"]});const H=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)");H&&H.addEventListener&&H.addEventListener("change",t);const U=window.AudioContext||window.webkitAudioContext,$=new U;let J;try{J=$.createMediaElementSource(h)}catch{return}const K=$.createAnalyser();K.fftSize=512,K.smoothingTimeConstant=O;const Q=$.createGain();function e(t,e=300){const a=$.currentTime,n=Math.max(.001,(0|e)/1e3),i=Q.gain;try{i.cancelScheduledValues(a),i.setValueAtTime(i.value,a),i.linearRampToValueAtTime(Math.max(0,Math.min(1,t)),a+n)}catch{}return new Promise(t=>setTimeout(t,Math.max(0,0|e)))}async function a(t=800){try{await $.resume()}catch{}try{await h.play()}catch{}sessionStorage.setItem(p,"1"),await e(1,t)}async function n(t=400){await e(0,t),h.pause(),sessionStorage.setItem(p,"0");try{sessionStorage.setItem(v,String(h.currentTime||0))}catch{}}function i(t={}){const e=t.selector||"[data-viz-toggle]";document.querySelectorAll(e).forEach(e=>o(e,t))}function o(t,e={}){const i=+t.dataset.fadeIn||e.fadeInMs||800,o=+t.dataset.fadeOut||e.fadeOutMs||400;t.setAttribute("role","button"),t.hasAttribute("tabindex")||(t.tabIndex=0);let s=0;const r=t=>{t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation())},c=e=>{t.classList.toggle("is-playing",!!e),t.setAttribute("aria-pressed",e?"true":"false")},d=t=>{t&&"click"===t.type&&Date.now()-s<350||(r(t),h.paused||h.ended?a(i).then(()=>c(!0)):n(o).then(()=>c(!1)))};t.addEventListener("touchend",t=>{s=Date.now(),d(t)},{passive:!1}),t.addEventListener("click",d,{passive:!1}),t.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||d(t)});const l="1"===sessionStorage.getItem(p)&&!h.paused;c(l)}Q.gain.value=0,J.connect(Q),Q.connect($.destination),Q.connect(K),function(){if(h.__vizPersistBound)return;h.__vizPersistBound=!0;const t=()=>{try{sessionStorage.setItem(v,String(h.currentTime||0))}catch{}};h.addEventListener("pause",t),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&t()}),window.addEventListener("pagehide",t),setInterval(()=>{h.paused||t()},2e3)}(),window.__audioViz={audio:h,context:$,analyser:K,gain:Q,fadeTo:e,playWithFade:a,pauseWithFade:n,initToggle:i};let X=Math.max(1,window.devicePixelRatio||1);const Y={count:0,ranges:[]};function s(){X=Math.max(1,window.devicePixelRatio||1);const e=m.clientWidth||1,a=m.clientHeight||1;g.width=Math.max(1,Math.round(e*X)),g.height=Math.max(1,Math.round(a*X)),w.setTransform(X,0,0,X,0,0),t(),Y.count=0}s(),window.addEventListener("resize",s,{passive:!0}),window.visualViewport&&visualViewport.addEventListener("resize",s,{passive:!0});const Z=new Uint8Array(K.frequencyBinCount);function r(t,e,a=2,n=e){const i=Math.max(a+1,Math.min(n,e)),o=Math.max(1,i-a),s=[];for(let e=0;e<t;e++){const n=e/t,r=(e+1)/t,c=Math.pow(n,V),d=Math.pow(r,V);let l=Math.floor(a+c*o),u=Math.floor(a+d*o);l<a&&(l=a),u<=l&&(u=Math.min(i,l+1)),u>i&&(u=i),s.push({i0:l,i1:u})}return s}let tt=[],et=1,at=0;function c(){at++%12==0&&t(),K.smoothingTimeConstant=O;const e=g.width/X,a=g.height/X;w.clearRect(0,0,e,a),K.getByteFrequencyData(Z);const n=Math.max(1,e-2*L);let i=Math.max(1,Math.floor(n/Math.max(1,A)));i=Math.min(T,i);let o=[];for(let t=0;t<i;t++)o[t]=t;"right"===j&&o.reverse();const s=F*Math.max(0,i-1),d=Math.max(1,(n-s)/i),l=a-2,u=Math.max(1,l-6);Y.count!==i&&(Y.count=i,Y.ranges=r(i,Z.length,2,Z.length),tt=new Array(i).fill(l-S));const m=new Array(i);let p=1e-4;for(let t=0;t<i;t++){const{i0:e,i1:a}=Y.ranges[t];let n=0,i=Math.max(1,a-e);for(let t=e;t<a;t++)n+=Z[t]||0;let o=n/i/255;o=Math.max(0,Math.min(1,o*P)),m[t]=o,o>p&&(p=o)}const v=h.paused||h.muted||p<W;if(!v&&k){const t=Math.min(q,.9/p);et+=(t-et)*C}else et+=.2*(1-et);const y=!v&&p<.08?1+R*(.08-p)/.08:1,f=Math.max(1,Math.floor(i*B)),M=Array.from({length:i},(t,e)=>e).sort((t,e)=>m[e]-m[t]),V=new Set(M.slice(0,f));for(let t=0;t<i;t++){const e=o[t],a=L+t*(d+F);let n,i;if(v)n=Math.min(u,N),i=l-n;else{const t=m[e];n=Math.max(2,Math.min(u,t*et*y*u)),V.has(e)&&n<D&&(n=Math.min(u,D)),i=l-n}const s=t%_==_-1;if(w.fillStyle=s?z:x,w.fillRect(a,i,d,n),"transparent"!==b&&""!==b){const t=i-S;let n=Number.isFinite(tt[e])?tt[e]:t;n=t<n?t:Math.min(n+I,t),tt[e]=n,w.fillStyle=b,w.fillRect(a,n-E,d,E)}}requestAnimationFrame(c)}function d(){const t=$.currentTime;Q.gain.cancelScheduledValues(t),Q.gain.setValueAtTime(Q.gain.value,t),Q.gain.linearRampToValueAtTime(1,t+1.2)}function l(){$.resume().catch(()=>{}),h.play().catch(()=>{}),d()}function u(){"1"!==sessionStorage.getItem(p)&&sessionStorage.setItem(p,"1"),l()}h.addEventListener("play",()=>sessionStorage.setItem(p,"1")),h.addEventListener("pause",()=>sessionStorage.setItem(p,"0")),window.addEventListener("pagehide",()=>{try{sessionStorage.setItem(v,String(h.currentTime||0))}catch{}}),h.addEventListener("loadedmetadata",()=>{try{const t=parseFloat(sessionStorage.getItem(v)||"0");Number.isFinite(t)&&h.duration&&t<h.duration&&(h.currentTime=t)}catch{}},{once:!0});const nt=document.querySelector(".preloader");nt&&nt.addEventListener("click",u,{once:!0}),"1"===sessionStorage.getItem(p)?h.play().then(()=>{$.resume().catch(()=>{}),d()}).catch(()=>{["pointerdown","click","keydown","touchstart"].forEach(t=>window.addEventListener(t,u,{once:!0,passive:!0}))}):["pointerdown","click","keydown","touchstart"].forEach(t=>window.addEventListener(t,u,{once:!0,passive:!0})),window.__audioViz&&"function"==typeof window.__audioViz.initToggle&&window.__audioViz.initToggle(),c()}catch(t){console.error("[viz] init error:",t)}}window.__audioVizInit||(window.__audioVizInit=!0,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t,{once:!0}):t())})();